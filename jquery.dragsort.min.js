!function(t){t.fn.dragsort=function(e){if("destroy"==e)return t(this.selector).trigger("dragsort-uninit"),void 0
	var r=t.extend({},t.fn.dragsort.defaults,e),a=[],o=null,i=null
	return this.each(function(e,n){t(n).is("table")&&1==t(n).children().size()&&t(n).children().is("tbody")&&(n=t(n).children().get(0))
		var d={draggedItem:null,placeHolderItem:null,pos:null,offset:null,offsetLimit:null,scroll:null,container:n,init:function(){r.tagName=0==t(this.container).children().size()?"li":t(this.container).children().get(0).tagName.toLowerCase(),""==r.itemSelector&&(r.itemSelector=r.tagName),""==r.dragSelector&&(r.dragSelector=r.tagName),""==r.placeHolderTemplate&&(r.placeHolderTemplate="<"+r.tagName+">&nbsp;</"+r.tagName+">"),t(this.container).attr("data-listidx",e).mousedown(this.grabItem).bind("dragsort-uninit",this.uninit),this.styleDragHandlers(!0)},uninit:function(){var e=a[t(this).attr("data-listidx")]
			t(e.container).unbind("mousedown",e.grabItem).unbind("dragsort-uninit"),e.styleDragHandlers(!1)},getItems:function(){return t(this.container).children(r.itemSelector)},styleDragHandlers:function(){this.getItems().map(function(){return t(this).is(r.dragSelector)?this:t(this).find(r.dragSelector).get()})},animateGrab:function(e){if(r.grabOptions){var a=t(this),o=r.grabOptions.draggedItemSelector?a.find(r.grabOptions.draggedItemSelector):a
			"grab"===e?(r.grabOptions.draggedItemClass&&o.addClass(r.grabOptions.draggedItemClass),"shiftRight"===r.grabOptions.clickAnimation&&a.css({left:10})):"drop"===e&&(r.grabOptions.draggedItemClass&&o.removeClass(r.grabOptions.draggedItemClass),"shiftRight"===r.grabOptions.clickAnimation&&a.css({left:0}))}},grabItem:function(e){var o=a[t(this).attr("data-listidx")],i=t(e.target).closest("[data-listidx] > "+r.tagName).get(0),n=o.getItems().filter(function(){return this==i}).size()>0
			if(!(1!=e.which||t(e.target).is(r.dragSelectorExclude)||t(e.target).closest(r.dragSelectorExclude).size()>0)&&n){e.preventDefault()
				for(var d=e.target;!t(d).is(r.dragSelector);){if(d==this)return
					d=d.parentNode}t(d).attr("data-cursor",t(d).css("cursor")),t(d).css("cursor","move"),o.animateGrab.call(i,"grab")
				var l=this,s=function(){o.dragStart.call(l,e),t(o.container).unbind("mousemove",s)}
				t(o.container).mousemove(s).mouseup(function(){o.animateGrab.call(i,"drop"),t(o.container).unbind("mousemove",s),t(d).css("cursor",t(d).attr("data-cursor"))})}},dragStart:function(e){if(null!=o&&null!=o.draggedItem&&o.dropItem(),o=a[t(this).attr("data-listidx")],o.draggedItem=t(e.target).closest("[data-listidx] > "+r.tagName),r.dragStart.apply(o.draggedItem)===!1)return o.draggedItem=null,void 0
			o.draggedItem.attr("data-origpos",t(this).attr("data-listidx")+"-"+t(o.container).children().index(o.draggedItem))
			var i=parseInt(o.draggedItem.css("marginTop")),n=parseInt(o.draggedItem.css("marginLeft"))
			if(o.offset=o.draggedItem.offset(),o.offset.top=e.pageY-o.offset.top+(isNaN(i)?0:i)-1,o.offset.left=e.pageX-o.offset.left+(isNaN(n)?0:n)-1,!r.dragBetween){var d=0==t(o.container).outerHeight()?Math.max(1,Math.round(.5+o.getItems().size()*o.draggedItem.outerWidth()/t(o.container).outerWidth()))*o.draggedItem.outerHeight():t(o.container).outerHeight()
				o.offsetLimit=t(o.container).offset(),o.offsetLimit.right=o.offsetLimit.left+t(o.container).outerWidth()-o.draggedItem.outerWidth(),o.offsetLimit.bottom=o.offsetLimit.top+d-o.draggedItem.outerHeight()}var l=o.draggedItem.height(),s=o.draggedItem.width()
			if("tr"==r.tagName?(o.draggedItem.children().each(function(){t(this).width(t(this).width())}),o.placeHolderItem=o.draggedItem.clone().attr("data-placeholder",!0),o.draggedItem.after(o.placeHolderItem),o.placeHolderItem.children().each(function(){t(this).css({borderWidth:0,width:t(this).width()+1,height:t(this).height()+1}).html("&nbsp;")})):(o.draggedItem.after(r.placeHolderTemplate),o.placeHolderItem=o.draggedItem.next().css({height:l,width:s}).attr("data-placeholder",!0)),"td"==r.tagName){var g=o.draggedItem.closest("table").get(0)
				t("<table id='"+g.id+"' style='border-width: 0px;' class='dragSortItem "+g.className+"'><tr></tr></table>").appendTo("body").children().append(o.draggedItem)}var c=o.draggedItem.attr("style")
			o.draggedItem.attr("data-origstyle",c?c:""),o.draggedItem.css({position:"absolute",opacity:1,"z-index":999,height:l,width:s}),o.scroll={moveX:0,moveY:0,maxX:t(document).width()-t(window).width(),maxY:t(document).height()-t(window).height()},o.scroll.scrollY=window.setInterval(function(){if(r.scrollContainer!=window)return t(r.scrollContainer).scrollTop(t(r.scrollContainer).scrollTop()+o.scroll.moveY),void 0
				var e=t(r.scrollContainer).scrollTop();(o.scroll.moveY>0&&e<o.scroll.maxY||o.scroll.moveY<0&&e>0)&&(t(r.scrollContainer).scrollTop(e+o.scroll.moveY),o.draggedItem.css("top",o.draggedItem.offset().top+o.scroll.moveY+1))},10),o.scroll.scrollX=window.setInterval(function(){if(r.scrollContainer!=window)return t(r.scrollContainer).scrollLeft(t(r.scrollContainer).scrollLeft()+o.scroll.moveX),void 0
				var e=t(r.scrollContainer).scrollLeft();(o.scroll.moveX>0&&e<o.scroll.maxX||o.scroll.moveX<0&&e>0)&&(t(r.scrollContainer).scrollLeft(e+o.scroll.moveX),o.draggedItem.css("left",o.draggedItem.offset().left+o.scroll.moveX+1))},10),t(a).each(function(t,e){e.createDropTargets(),e.buildPositionTable()}),o.setPos(e.pageX,e.pageY),t(document).bind("mousemove",o.swapItems),t(document).bind("mouseup",o.dropItem),r.scrollContainer!=window&&t(window).bind("DOMMouseScroll mousewheel",o.wheel)},setPos:function(e,a){var i=a-this.offset.top,n=e-this.offset.left
			r.dragBetween||(i=Math.min(this.offsetLimit.bottom,Math.max(i,this.offsetLimit.top)),n=Math.min(this.offsetLimit.right,Math.max(n,this.offsetLimit.left)))
			var d=this.draggedItem.offsetParent().not("body").offset()
			if(null!=d&&(i-=d.top,n-=d.left),r.scrollContainer==window)a-=t(window).scrollTop(),e-=t(window).scrollLeft(),a=Math.max(0,a-t(window).height()+5)+Math.min(0,a-5),e=Math.max(0,e-t(window).width()+5)+Math.min(0,e-5)
			else{var l=t(r.scrollContainer),s=l.offset()
				a=Math.max(0,a-l.height()-s.top)+Math.min(0,a-s.top),e=Math.max(0,e-l.width()-s.left)+Math.min(0,e-s.left)}o.scroll.moveX=0==e?0:e*r.scrollSpeed/Math.abs(e),o.scroll.moveY=0==a?0:a*r.scrollSpeed/Math.abs(a),"shiftRight"===r.grabOptions.clickAnimation&&(n+=10),this.draggedItem.css({top:i,left:n})},wheel:function(e){if((t.browser.safari||t.browser.mozilla)&&o&&r.scrollContainer!=window){var a=t(r.scrollContainer),i=a.offset()
			if(e.pageX>i.left&&e.pageX<i.left+a.width()&&e.pageY>i.top&&e.pageY<i.top+a.height()){var n=e.detail?5*e.detail:e.wheelDelta/-2
				a.scrollTop(a.scrollTop()+n),e.preventDefault()}}},buildPositionTable:function(){var e=[]
			this.getItems().not([o.draggedItem[0],o.placeHolderItem[0]]).each(function(r){var a=t(this).offset()
				a.right=a.left+t(this).outerWidth(),a.bottom=a.top+t(this).outerHeight(),a.elm=this,e[r]=a}),this.pos=e},dropItem:function(){if(null!=o.draggedItem){var e=o.draggedItem.attr("data-origstyle")
			if(o.draggedItem.attr("style",e),""==e&&o.draggedItem.removeAttr("style"),o.draggedItem.removeAttr("data-origstyle"),o.styleDragHandlers(!0),o.placeHolderItem.before(o.draggedItem),o.placeHolderItem.remove(),t("[data-droptarget], .dragSortItem").remove(),window.clearInterval(o.scroll.scrollY),window.clearInterval(o.scroll.scrollX),o.draggedItem.attr("data-origpos")!=t(a).index(o)+"-"+t(o.container).children().index(o.draggedItem)&&0==r.dragEnd.apply(o.draggedItem)){var i=o.draggedItem.attr("data-origpos").split("-"),n=t(a[i[0]].container).children().not(o.draggedItem).eq(i[1])
				n.size()>0?n.before(o.draggedItem):0==i[1]?t(a[i[0]].container).prepend(o.draggedItem):t(a[i[0]].container).append(o.draggedItem)}return o.draggedItem.removeAttr("data-origpos"),o.animateGrab.call(o.draggedItem,"drop"),o.draggedItem=null,t(document).unbind("mousemove",o.swapItems),t(document).unbind("mouseup",o.dropItem),r.scrollContainer!=window&&t(window).unbind("DOMMouseScroll mousewheel",o.wheel),!1}},swapItems:function(e){if(null==o.draggedItem)return!1
			o.setPos(e.pageX,e.pageY)
			for(var n=o.findPos(e.pageX,e.pageY),d=o,l=0;-1==n&&r.dragBetween&&l<a.length;l++)n=a[l].findPos(e.pageX,e.pageY),d=a[l]
			if(-1==n)return!1
			var s=function(){return t(d.container).children().not(d.draggedItem)},g=s().not(r.itemSelector).each(function(){this.idx=s().index(this)})
			return null==i||i.top>o.draggedItem.offset().top||i.left>o.draggedItem.offset().left?t(d.pos[n].elm).before(o.placeHolderItem):t(d.pos[n].elm).after(o.placeHolderItem),g.each(function(){var e=s().eq(this.idx).get(0)
				this!=e&&s().index(this)<this.idx?t(this).insertAfter(e):this!=e&&t(this).insertBefore(e)}),t(a).each(function(t,e){e.createDropTargets(),e.buildPositionTable()}),i=o.draggedItem.offset(),!1},findPos:function(t,e){for(var a=0;a<this.pos.length;a++)if(this.pos[a].top<e&&this.pos[a].bottom>e&&(r.sortOnAnyXAxis||this.pos[a].left<t&&this.pos[a].right>t))return a
			return-1},createDropTargets:function(){r.dragBetween&&t(a).each(function(){var e=t(this.container).find("[data-placeholder]"),a=t(this.container).find("[data-droptarget]")
			e.size()>0&&a.size()>0?a.remove():0==e.size()&&0==a.size()&&("td"==r.tagName?t(r.placeHolderTemplate).attr("data-droptarget",!0).appendTo(this.container):t(this.container).append(o.placeHolderItem.removeAttr("data-placeholder").clone().attr("data-droptarget",!0)),o.placeHolderItem.attr("data-placeholder",!0))})}}
		d.init(),a.push(d)}),this},t.fn.dragsort.defaults={itemSelector:"",dragSelector:"",dragSelectorExclude:"input, textarea",dragStart:function(){},dragEnd:function(){},dragBetween:!1,placeHolderTemplate:"",scrollContainer:window,scrollSpeed:5,grabOptions:!1,sortOnAnyXAxis:!1}}(jQuery)
